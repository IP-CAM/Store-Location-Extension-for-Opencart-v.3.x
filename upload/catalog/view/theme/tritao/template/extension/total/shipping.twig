<td colspan="3.99">
    <div class="input-group col-md-6">
        <label class="col-md-2 col-form-label" for="input-postcode">{{ entry_postcode }}</label>
        <input type="text" name="postcode" value="{{ postcode }}" placeholder="{{ entry_postcode }}" maxlength="8" id="input-postcode" class="form-control"/>
        <input type="hidden" id="input-country" name="country_id" value="30" >
        <input type="hidden" id="input-zone" name="zone_id" value="464" >
        <div class="input-group-append">
            <button type="button" id="button-quote" data-loading-text="{{ text_loading }}" class="input-group-text btn btn-primary">{{ button_quote }}</button>
        </div>
        <small class="text-muted pl-3 pt-2">
            <a href="http://www.buscacep.correios.com.br/sistemas/buscacep/" target="_blank"><i class="icon-question-sign"></i>NÃ£o sei meu CEP</a>
        </small>
    </div>
        <div class="error"  ></div>  
</td>
{% if shipping_method %}
<script type="text/javascript">
$(document).ready(function() {
$('#button-quote').trigger('click');
});
</script>
 {% endif %}
<script type="text/javascript"><!--
$(document).on('change', 'input[name=\'shipping_method\']:checked', function() {
    saveShippingMethod();
});
//--></script>
<script type="text/javascript"><!--
    $('#button-quote').on('click', function () {
        $.ajax({
            url: 'index.php?route=extension/total/shipping/quote',
            type: 'post',
            data: 'country_id=' + $('input[name=\'country_id\']').val() + '&zone_id=' + $('input[name=\'zone_id\']').val() + '&postcode=' + encodeURIComponent($('input[name=\'postcode\']').val()),
            dataType: 'json',
            beforeSend: function () {
                // $('#button-quote').button('loading');
               // $('.shipping-info').addClass('valor-loading');
		$('.shipping-info').addClass('loading');
            },
            complete: function () {
	         $('.shipping-info').removeClass('loading');

            },
            success: function (json) {
                $('.alert-dismissible, .text-danger').remove();

                if (json['error']) {
                    if (json['error']['warning']) {
                        $('#collapse-shipping .card-body').prepend('<div class="alert alert-danger alert-dismissible"><i class="fas fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                    }

                    if (json['error']['country']) {
                        $('select[name=\'country_id\']').after('<div class="text-danger">' + json['error']['country'] + '</div>');
                    }

                    if (json['error']['zone']) {
                        $('select[name=\'zone_id\']').after('<div class="text-danger">' + json['error']['zone'] + '</div>');
                    }

                    if (json['error']['postcode']) {
                        $('input[name=\'postcode\']').after('<div class="text-danger">' + json['error']['postcode'] + '</div>');
                    }
                }

                if (json['shipping_method']) {
                   // $('#modal-shipping').remove();
                    $(".shipping-info ul").html("");
                   	var html = "";
                    for (i in json['shipping_method']) {

                        if (!json['shipping_method'][i]['error']) {
                            for (j in json['shipping_method'][i]['quote']) {
                           html += '     <li>';
                            if (json['shipping_method'][i]['quote'][j]['code'] == '{{ shipping_method }}') {
                                    html += '<div class="custom-control custom-radio">';
                                    html += '<input type="radio" id="custom-' + json['shipping_method'][i]['quote'][j]['code'] + '" name="shipping_method" value="' + json['shipping_method'][i]['quote'][j]['code'] + '" class="custom-control-input" checked="checked" /> ';
                                    html += '<label class="custom-control-label" for="custom-' + json['shipping_method'][i]['quote'][j]['code'] + '">'+ json['shipping_method'][i]['quote'][j]['title'] + ' - ' + json['shipping_method'][i]['quote'][j]['text']+'</label>';
                                    html += '</div>';
                                } else {
                                    html += '<div class="custom-control custom-radio">';
                                    html += '<input type="radio" id="custom-' + json['shipping_method'][i]['quote'][j]['code'] + '" name="shipping_method" value="' + json['shipping_method'][i]['quote'][j]['code'] + '" class="custom-control-input"/> ';
                                    html += '<label class="custom-control-label" for="custom-' + json['shipping_method'][i]['quote'][j]['code'] + '">'+ json['shipping_method'][i]['quote'][j]['title'] + ' - ' + json['shipping_method'][i]['quote'][j]['text']+'</label>';
                                    html += '</div>';
                                   // html += '<input type="radio" name="shipping_method" value="' + json['shipping_method'][i]['quote'][j]['code'] + '" /> ';
                                }
		                           html += '</li>';
                              
                            }
                        } else {
                            html += '<div class="alert alert-danger alert-dismissible">' + json['shipping_method'][i]['error'] + '</div>';
                        }
                    }
           
                            //html += '      </ul>';
                         $(".shipping-info ul").append(html)
                         //   $('.shipping-info').append(html);


                            $('input[name=\'shipping_method\']').on('change', function () {
                                $('#button-shipping').prop('disabled', false);
                            });
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            });

            $(document).delegate('#button-shipping', 'click', function () {
                $.ajax({
                    url: 'index.php?route=extension/total/shipping/shipping',
                    type: 'post',
                    data: 'shipping_method=' + encodeURIComponent($('input[name=\'shipping_method\']:checked').val()),
                    dataType: 'json',
                    beforeSend: function () {
                        $('#button-shipping').button('loading');
                    },
                    complete: function () {
                        $('#button-shipping').button('reset');
                    },
                    success: function (json) {
                        $('.alert-dismissible').remove();

                        if (json['error']) {
                            $('.breadcrumb').after('<div class="alert alert-danger alert-dismissible"><i class="fas fa-exclamation-circle"></i> ' + json['error'] + '<button type="button" class="close" data-dismiss="alert">&times;</button></div>');

                            $('html, body').animate({scrollTop: 0}, 'slow');
                        }

                        if (json['redirect']) {
                            location = json['redirect'];
                        }
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            });
            //--></script>
  <script type="text/javascript"><!--
  $('select[name=\'country_id\']').on('change', function () {
          $.ajax({
              url: 'index.php?route=extension/total/shipping/country&country_id=' + this.value,
              dataType: 'json',
              beforeSend: function () {
                  $('select[name=\'country_id\']').prop('disabled', true);
              },
              complete: function () {
                  $('select[name=\'country_id\']').prop('disabled', false);
              },
              success: function (json) {
                  if (json['postcode_required'] == '1') {
                      $('input[name=\'postcode\']').parent().parent().addClass('required');
                  } else {
                      $('input[name=\'postcode\']').parent().parent().removeClass('required');
                  }

                  html = '<option value="">{{ text_select }}</option>';

                  if (json['zone'] && json['zone'] != '') {
                      for (i = 0; i < json['zone'].length; i++) {
                          html += '<option value="' + json['zone'][i]['zone_id'] + '"';

                          if (json['zone'][i]['zone_id'] == '{{ zone_id }}') {
                              html += ' selected="selected"';
                          }

                          html += '>' + json['zone'][i]['name'] + '</option>';
                      }
                  } else {
                      html += '<option value="0" selected="selected">{{ text_none }}</option>';
                  }

                  $('select[name=\'zone_id\']').html(html);
              },
              error: function (xhr, ajaxOptions, thrownError) {
                  alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
              }
          });
      });

      $('select[name=\'country_id\']').trigger('change');
      //--></script>
